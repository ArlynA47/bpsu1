<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../images/hirna-logo.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="../css/output.css">
    <title>HirNa! - Find Your Next Job</title>
    <style>
        .activeLink {
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        .demo-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .tinder-card {
            width: 750px;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <nav class="flex justify-between bg-[#232323] p-2.5 sticky top-0 z-50">
        <div class="flex flex-1 justify-start items-end gap-2">
            <img src="../images/hirna-logo.png" alt="HirNa Logo" class="h-10 w-10">
        </div>

        <div class="flex flex-2 justify-between items-center gap-6">
            <a href="../../index.html" class="flex-1 text-center text-white hover:text-gray-300">Home</a>
            <a href="find-jobs-unauth.html" class="flex-1 text-center text-white hover:text-gray-300 activeLink">Explore
                Opportunities</a>
        </div>

        <div class="flex flex-1 justify-end items-center gap-4">
            <a href="../html/login.html"
                class="bg-[#315E26] text-white px-4 py-2 rounded hover:bg-[#3F742F] cursor-pointer">
                Log In
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col items-center gap-6 p-10 relative">
        <div class="demo-counter">Demo: <span id="demoCount">1</span>/7</div>

        <div class="flex flex-col items-center gap-1">
            <h3 class="text-[#3D3D3D] text-3xl font-semibold">Find Your Perfect Job - Platform Demo</h3>
            <p class="text-[#545454] text-xl">
                <span class="text-[#315E26] font-semibold">Try our platform!</span> Log in to browse jobs matching your
                skills
            </p>
        </div>

        <div class="flex flex-col items-center justify-between flex-1 w-xl gap-8">
            <!-- Job Card -->
            <div class="tinder-card transition-opacity duration-300">
                <div class="flex justify-between gap-5">
                    <div class="flex flex-1 flex-col">
                        <span
                            class="flex-1 text-[#3D3D3D] text-2xl font-bold overflow-hidden whitespace-nowrap text-ellipsis"
                            id="jobTitle">
                            Loading job...
                        </span>
                        <span class="flex-1 text-[#3D3D3D] text-md overflow-hidden whitespace-nowrap text-ellipsis"
                            id="companyName">
                            Loading company...
                        </span>
                    </div>
                    <span class="text-[#3D3D3D] text-sm flex items-center gap-1" id="postedDate">
                        <i class="far fa-clock text-[#3D3D3D] text-xs"></i>
                        Loading date...
                    </span>
                </div>

                <div class="flex flex-col gap-2 mt-4">
                    <h3 class="text-[#65956C] text-lg font-bold">Job Offer</h3>
                    <p class="text-[#3D3D3D] text-md leading-relaxed" id="jobOffer">
                        Loading job offer details...
                    </p>
                </div>

                <div class="flex flex-col gap-2 mt-4">
                    <h3 class="text-[#65956C] text-lg font-bold">Job Location</h3>
                    <div class="flex flex-wrap gap-2">
                        <span
                            class="inline-block text-md px-4 py-1 rounded-lg border text-center bg-[#E8F5E9] border-[#73A267] text-[#2E7D32] font-semibold"
                            id="jobLocation">
                            Loading location...
                        </span>
                    </div>
                </div>

                <div class="flex flex-col gap-2 mt-4">
                    <div class="flex items-center gap-4">
                        <h3 class="text-[#65956C] text-lg font-bold">Skills Required</h3>
                        <span class="font-normal text-center text-xs px-2 py-1 rounded-md bg-[#65956C] text-white"
                            id="skillsMatchCount">
                            0 Matches
                        </span>
                    </div>
                    <div class="flex flex-wrap gap-2" id="skillsContainer">
                        <span
                            class="inline-block text-md px-4 py-1 rounded-lg border text-center bg-[#E8F5E9] border-[#73A267] text-[#2E7D32] font-semibold">
                            Loading skills...
                        </span>
                    </div>
                </div>

                <div class="flex justify-between text-[#3D3D3D] text-md gap-2 mt-4">
                    <div class="flex flex-col gap-2">
                        <span class="flex items-center gap-2" id="vacancies">
                            <i class="fas fa-door-open text-[#65956C]"></i>
                            <strong>Vacancies:</strong> Loading...
                        </span>
                        <span class="flex items-center gap-2" id="email">
                            <i class="fas fa-envelope text-[#65956C]"></i>
                            <strong>Email:</strong> Loading...
                        </span>
                    </div>
                    <span class="flex items-center gap-2" id="needed">
                        <i class="fas fa-users text-[#65956C]"></i>
                        <strong>Needed:</strong> Loading...
                    </span>
                    <span class="flex items-center gap-2" id="contact">
                        <i class="fas fa-phone-alt text-[#65956C]"></i>
                        <strong>Contact:</strong> Loading...
                    </span>
                </div>

                <div class="mt-2 text-[#3D6585] font-semibold hidden" id="priority">
                    <i class="fas fa-star"></i> Priority - This employer likes profiles like yours
                </div>
            </div>

            <!-- Button Card -->
            <div
                class="button-card h-[100px] w-[75%] bg-white rounded-xl border-3 border-[#65956C] p-4 flex justify-center items-center shadow-xl gap-24">
                <!-- Pass Button -->
                <button
                    class="w-16 h-16 bg-[#D33B3B] rounded-full flex items-center justify-center hover:bg-[#b32f2f] cursor-pointer"
                    id="passBtn">
                    <i class="fas fa-times text-2xl text-white"></i>
                </button>

                <!-- Like Button -->
                <button
                    class="w-16 h-16 bg-[#73A267] rounded-full flex items-center justify-center hover:bg-[#5c8651] cursor-pointer"
                    id="likeBtn">
                    <i class="fas fa-heart text-2xl text-white"></i>
                </button>
            </div>
        </div>

        <!-- Sign Up CTA (hidden initially) -->
        <div id="signupCta"
            class="hidden flex flex-col items-center gap-4 p-6 bg-[#F8F8F8] rounded-lg border border-[#65956C] max-w-md text-center">
            <h3 class="text-[#3D3D3D] text-2xl font-bold">Ready to find your dream job?</h3>
            <p class="text-[#545454]">Sign up now to access of job opportunities matching your skills!</p>
            <div class="flex gap-4 mt-2">
                <a href="../html/employee-registration.html"
                    class="bg-[#315E26] text-white px-6 py-2 rounded hover:bg-[#3F742F]">
                    Register Now
                </a>
                <a href="../html/login.html"
                    class="bg-white text-[#315E26] px-6 py-2 rounded border border-[#315E26] hover:bg-[#F0F0F0]">
                    Log In
                </a>
            </div>
        </div>
    </div>

    <div id="toast"
        class="fixed top-1/2 left-1/2 transform -translate-x-1/2 translate-y-[12rem] bg-[#73A267] text-white px-6 py-3 rounded opacity-0 shadow-lg pointer-events-none transition-opacity duration-300 z-50">
        Job saved!
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCM1QSKbZH9Ih3RHv39nQipYoti8Yrji_M",
            authDomain: "careerstep-bpsu1.firebaseapp.com",
            projectId: "careerstep-bpsu1",
            storageBucket: "careerstep-bpsu1.firebasestorage.app",
            messagingSenderId: "17047315291",
            appId: "1:17047315291:web:dc2c9312e3d5b0ced5307e",
            measurementId: "G-WH6DT9HQW2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // DOM Elements
        const jobTitleEl = document.getElementById('jobTitle');
        const companyNameEl = document.getElementById('companyName');
        const passBtn = document.getElementById('passBtn');
        const likeBtn = document.getElementById('likeBtn');
        const toast = document.getElementById('toast');
        const signupCta = document.getElementById('signupCta');
        const demoCountEl = document.getElementById('demoCount');
        const skillsContainer = document.getElementById('skillsContainer');

        // Demo variables
        let currentDemoIndex = 0;
        let availableJobs = [];
        const maxDemos = 7;

        // Initialize the demo
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadJobs();
                displayDemoJob();

                // Button event listeners
                passBtn.addEventListener('click', nextDemoJob);
                likeBtn.addEventListener('click', likeDemoJob);
            } catch (error) {
                console.error("Error initializing demo:", error);
            }
        });

        // Load jobs from Firestore
        async function loadJobs() {
            try {
                // Query active jobs
                const q = query(collection(db, 'jobSeeds'), where('status', '==', 'active'));
                const querySnapshot = await getDocs(q);
                
                // Get random 7 jobs
                const allJobs = [];
                querySnapshot.forEach(doc => {
                    allJobs.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Shuffle and take first 7
                availableJobs = shuffleArray(allJobs).slice(0, 7);
                
                if (availableJobs.length === 0) {
                    console.warn("No jobs found in database");
                    showSignupCta();
                }
            } catch (error) {
                console.error("Error loading jobs:", error);
                showSignupCta();
            }
        }

        // Helper function to shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Format post date
        function formatPostDate(date) {
            if (!date) return "Recently";
            
            const now = new Date();
            const postDate = date.toDate ? date.toDate() : new Date(date);
            const diff = now - postDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return 'Today';
            if (days === 1) return 'Yesterday';
            if (days < 7) return `${days} days ago`;
            if (days < 30) return `${Math.floor(days / 7)} week${Math.floor(days / 7) > 1 ? 's' : ''} ago`;
            return postDate.toLocaleDateString();
        }

        // Display current demo job
        async function displayDemoJob() {
            if (currentDemoIndex >= availableJobs.length) {
                showSignupCta();
                return;
            }

            demoCountEl.textContent = currentDemoIndex + 1;
            const job = availableJobs[currentDemoIndex];

            // Update all fields
            jobTitleEl.textContent = job.jobTitle || "No title provided";
            document.getElementById('jobOffer').textContent = job.offer || "No offer details provided";
            document.getElementById('jobLocation').textContent = job.location || "Location not specified";
            document.getElementById('postedDate').innerHTML = `<i class="far fa-clock text-[#3D3D3D] text-xs"></i> Posted ${formatPostDate(job.createdAt)}`;
            
            // Update skills - we'll show all skills without matching since user isn't logged in
            const skills = job.skills || [];
            document.getElementById('skillsMatchCount').textContent = skills.length > 0 ? `${skills.length} Skills` : "No skills specified";
            
            // Clear and rebuild skills container
            skillsContainer.innerHTML = '';
            skills.forEach(skill => {
                const skillEl = document.createElement('span');
                skillEl.className = 'inline-block text-md px-4 py-1 rounded-lg border text-center bg-[#E8F5E9] border-[#73A267] text-[#2E7D32] font-semibold';
                skillEl.textContent = skill;
                skillsContainer.appendChild(skillEl);
            });
            
            // If no skills, show a message
            if (skills.length === 0) {
                const noSkillsEl = document.createElement('span');
                noSkillsEl.className = 'inline-block text-md px-4 py-1 rounded-lg border text-center bg-gray-100 border-gray-300 text-gray-600';
                noSkillsEl.textContent = 'No specific skills required';
                skillsContainer.appendChild(noSkillsEl);
            }

            // Try to get company info
            let companyName = "Company not specified";
            let contactNumber = "Not provided";
            let email = job.employerEmail || "Not provided";
            
            try {
                if (job.employerId) {
                    const employerDoc = await getDoc(doc(db, 'employers', job.employerId));
                    if (employerDoc.exists()) {
                        const employerData = employerDoc.data();
                        companyName = employerData.companyInfo?.companyName || "Company not specified";
                        contactNumber = employerData.companyInfo?.contactNumber || "Not provided";
                    }
                }
            } catch (error) {
                console.error("Error fetching employer info:", error);
            }
            
            companyNameEl.textContent = companyName;

            // Update other info
            document.getElementById('vacancies').innerHTML = `<i class="fas fa-door-open text-[#65956C]"></i><strong>Vacancies:</strong> ${job.positionsAvailable ?? 'Not specified'}`;
            document.getElementById('email').innerHTML = `<i class="fas fa-envelope text-[#65956C]"></i><strong>Email:</strong> ${email}`;
            document.getElementById('needed').innerHTML = `<i class="fas fa-users text-[#65956C]"></i><strong>Needed:</strong> ${job.positionsNeeded || 'Not specified'}`;
            document.getElementById('contact').innerHTML = `<i class="fas fa-phone-alt text-[#65956C]"></i><strong>Contact:</strong> ${contactNumber}`;

            // Hide priority since we don't have user info
            document.getElementById('priority').classList.add('hidden');
        }

        // Show next demo job
        function nextDemoJob() {
            currentDemoIndex++;
            if (currentDemoIndex < maxDemos && currentDemoIndex < availableJobs.length) {
                displayDemoJob();
            } else {
                showSignupCta();
            }
        }

        // Like current demo job
        function likeDemoJob() {
            // Show toast
            toast.textContent = "Job saved! (Sign up to apply)";
            toast.classList.remove('opacity-0', 'pointer-events-none');

            setTimeout(() => {
                toast.classList.add('opacity-0', 'pointer-events-none');
                nextDemoJob();
            }, 1000);
        }

        // Show signup CTA after all demos
        function showSignupCta() {
            document.querySelector('.tinder-card').classList.add('hidden');
            document.querySelector('.button-card').classList.add('hidden');
            signupCta.classList.remove('hidden');
            demoCountEl.textContent = Math.min(availableJobs.length, maxDemos);
        }
    </script>
</body>

</html>